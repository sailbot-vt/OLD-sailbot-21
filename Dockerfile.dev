FROM debian:stretch

# Settings env variables
ENV HOSTNAME debian-stretch

# http://bugs.python.org/issue19846
# > At the moment, setting "LANG=C" on a Linux system *fundamentally breaks Python 3*, and that's not OK.
ENV LANG C.UTF-8

# Installing build packages
RUN apt-get update && apt-get install -y --no-install-recommends \
        make \
        wget \
        build-essential \
    && rm -rf /var/lib/apt/lists/*

# Installing python development tools
# > It may be beneficial to specify versions of python & pip here.
RUN apt-get update && apt-get install -y --no-install-recommends \
        python3 \
        python3-pip \
        python3-wheel \
        python3-setuptools \
        python3-dev \
    && rm -rf /var/lib/apt/lists/*

# Updating pip to latest version
RUN pip3 install --upgrade pip

# set PYTHONPATH to point to site-packages
ENV PYTHONPATH /usr/local/lib/python3.5/site-packages

# Caching these layers to improve build time for larger packages.
# -----------------------------------------------------
# > Add additional packages here on separate RUN lines
# > to cache larger installation steps into docker daemon

# Installing numpy, scipy, opencv
RUN apt-get update && apt-get install -y --no-install-recommends \
        python3-numpy \
        python3-scipy \
        python3-opencv \
    && rm-rf /var/lib/apt/lists/*

# Installing dependencies for filterpy
RUN apt-get update && apt-get install -y --no-install-recommends \
        pkg-config \
        libfreetyp6-dev \
    && rm-rf /var/lib/apt/lists/*

RUN pip3 install filterpy

# -----------------------------------------------------

WORKDIR /sailbot

# Installing development requirements
COPY requirements.dev.txt ./
RUN pip3 install -r requirements.dev.txt \
    && mkdir logs

# Copying source files to image
COPY scripts ./scripts
COPY tests ./tests
COPY Makefile main.py ./
COPY src ./src
